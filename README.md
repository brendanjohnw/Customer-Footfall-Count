# OpenCV People Tracker and Counter 
## A Customer Footfall Count Project. (Brendan Lee and Seak Jian De)
The following project is a computer vision customer footfall counter that utilizes OpenCV for object tracking and detection. 
The detectiion mechanism was supplemented by pre-trained YoloV4 datasets, which were adapted from Common Objects in Common (COCO).

The main application of the project was to count the in-rate and out-rate of people enterring a particular premise such as a train station
shopping mall or retail store.

The following program makes use of 2 types of detection algorithms

 - The initial estimation of the total patrons in the area were counted using the Histogram of Gradients (HOG) detection algorithm for accurate detection of people in the first frame of the video. We initially planned to use HOG for detection throughout the video but proved to show much poorer performance than using YoloV4 weights with OpenCV's DNN library.

 - The tracking was implemented by calculating and grouping the closest centroid points generated by the object detector. 

## Features
- Detect people in the video footage
- Tracking the people and asign with random ids
- Count the number of people entring or exiting by analyze the people moving up or down

## Tech
***Object Detection*** <br />
We apply YOLOv4 (You Only Look Once) object detection algorithm using Python and OpenCV.
There is also other object detection algorithm outside example Mask-RCNN and the advatages of YOLO compare to other its work very fast and accuracy which doesn't required much GPU processing power.

***Object Tracking*** <br />
For object trackng we implement centroid tracking algorithms.
For this algorithms is that we passing in a list of bounding box (x,y)-cordinates for each object detected with our object detection model.
Then we compute Eudclidean distance between new bonding and existing objects
After that we assume the object will move in between subsequent frames. Thus, we choose to assign the centroid with minimum distance bewteen objects

Disadvatage:-
- When the person loss detection it will start assign with new ids which will effect the counting

***Count People*** <br />
We set a line around 3/4 heights then we store the object detected in a dictionary then if the object passed the line. We load the initial Y-Centroid to compare with current frame and determine the person is moving up or down

## Data Visualization using Tableau (Kong Yuki)
**Initial plan:** Use Tableau to visualize data set generated from OpenCV in a dashboard

**Problem encountered:** Video is too short, little can be predicted based on raw coordinates of all people per frame.

**Alternative:** Use Toronto Station Bikeshare Data (sample data) as an example on how to visualize long term footfall count data

Dashboard for OpenCV data set:
https://public.tableau.com/views/OpenCVData/CumulativeCountbySeconds?:language=en-US&publish=yes&:display_count=n&:origin=viz_share_link

Visualizations created:
- Cumulative Count by Seconds

Dashboard for Pedestrian Footfall Index in Dublin City Centre (sample data):
https://public.tableau.com/views/PedestrianFootfallIndexinDublinCityCentre/Dashboard1?:language=en-US&publish=yes&:display_count=n&:origin=viz_share_link

Visualizations created:
- Hourly footfall trend (grouped by days of the week)
- Hourly net difference trend (grouped by days of the week)
- Daily trend (grouped by date)

## Limitations
Object tracking is not effiecient

## Future Directions
If more time and computing power is available, more sophisticated deep learning techniques can be implemented to identify additional features captured by the camera.

An example use case would be retail development. Building a new shopping complex is an expensive investment and understanding the demographics in the area would be a key component to ensure maximum business success. Footfall Traffic analysis with AI computer vision can be used to determine the income level of the people walking pass the particular area by looking at the types of clothing, apparel worn by potential patrons to ascertain what kind of shops to have in the complex. 


## Dependencies

OpenCV:https://docs.opencv.org/4.x/d4/db1/tutorial_documentation.html

Numpy: https://numpy.org/doc/stable/

Matplotlib: https://matplotlib.org/stable/api/index

YoloV4: https://github.com/pjreddie/darknet

# References

Pedestrian Footfall Index in Dublin City Centre (sample data): https://data.world/ie-dublin-city-bus/952a55ab-f222-4249-8086-7bf9fdeba723

PyImageSearch People tracker and counter: https://www.pyimagesearch.com/2018/08/13/opencv-people-counter/

Non-Maxima suppression: https://learnopencv.com/non-maximum-suppression-theory-and-implementation-in-pytorch/
